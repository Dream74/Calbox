{% extends "base.html"%}
{% block title %}CAL-X{% endblock %}
{% block head %}
<link rel="stylesheet" TYPE="text/css" href="/codemirror/lib/codemirror.css">
<link rel="stylesheet" TYPE="text/css" href="/codemirror/doc/docs.css">
<script src="/codemirror/lib/codemirror.js"></script>
<script src="/codemirror/mode/clike/clike.js"></script>
<style>.CodeMirror {border: 2px inset #dee;}</style>

<link rel="stylesheet" href="/codemirror/theme/neat.css">
<link rel="stylesheet" href="/codemirror/theme/elegant.css">
<link rel="stylesheet" href="/codemirror/theme/night.css">
<link rel="stylesheet" href="/codemirror/theme/monokai.css">
<link rel="stylesheet" href="/codemirror/theme/cobalt.css">
<link rel="stylesheet" href="/codemirror/theme/eclipse.css">
<link rel="stylesheet" href="/codemirror/theme/rubyblue.css">
<script src="/codemirror/mode/javascript/javascript.js"></script>


<link rel="stylesheet" TYPE="text/css" href="/jquery-ui/themes/base/jquery.ui.all.css">
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
<script src="/jquery-ui/ui/jquery.ui.core.js"></script>
<script src="/jquery-ui/ui/jquery.ui.widget.js"></script>
<script src="/jquery-ui/ui/jquery.ui.tabs.js"></script>
<script language="javascript">
$(function() {
	$( "#tabs" ).tabs({
		ajaxOptions: {
			error: function( xhr, status, index, anchor ) {
				$( anchor.hash ).html(
					"Couldn't load this tab. We'll try to fix this as soon as possible. " +
					"If this wouldn't be a demo." );
			}
		}
	});

	$("#lang").change(function(){ //事件發生
    $("#example").attr( "href", "?example_lang="+ $(this).val() );
	});
	
	$("#question").change(function(){ //事件發生
    $("#tabs .doc ").attr( "href", "/cal-x/doc/"+ $(this).val() );
	});
  
	/* attach a submit handler to the form */
  $("#codeform").submit(function(event) {
    /* stop form from submitting normally */
    event.preventDefault(); 

    /* get some values from elements on the page: */
    var $form = $( this ),
        lang = $form.find( '#lang' ).val(),
        question = $form.find( '#question' ).val(),
        csrf = $form.find( 'input[name="csrfmiddlewaretoken"]' ).val(),
        code = editor.getValue(),
        url = $form.attr( 'action' );
		// alert("action :" + url + "lang :"+ lang+ "question :"+question+"code :" + code + "csrf :" + csrf);
    /* Send the data using post and put the results in a div */
     $.post( url, { lang: lang, question: question, code : code, csrfmiddlewaretoken : csrf  },
      function( data ) {
          //var content = $( data ).find( '#content' );
					alert( data.message  )
      }, 'json');

  });


  var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
    lineNumbers: true,
    matchBrackets: true,
    mode: "text/x-csrc",
  });
 
	$("#code_theme").change(function(){ //事件發生
  	editor.setOption("theme", $(this).val() );
	});

});

</script>

{% endblock %}
{% block content %}
{% if user.is_authenticated %}
<p>歡迎, {{ user.username }}. 感謝您登入.</p>
<a href="/accounts/logout/" >登出</a>
<a href="/accounts/password_change/">變更密碼</a>
{% else %}
  <p>歡迎, 如需更多操作請登入.</p>
<a href="/accounts/login/" >登入</a>
<a href="/accounts/password_reset/" >忘記密碼</a>
<a>變更密碼</a>
{% endif %}

<a>題庫</a>
<button>歷史</button>
<button>求救</button>
<button>問題</button>
<form id="codeform" action="{% url calbox.cal_x.views.update_post_code %}" method="POST">{% csrf_token %}
<label>題目</label>
<select name="question" id="question" >
{% if q_list %}
	{% for list in q_list %}
	<option value="{{ list.id }}" label="{{ list.title }}"/>
	{% endfor %}
{% endif %}
</select>

<label>程式語言</label>
<select name="lang" id="lang" >
	<option value="11" label="C" title="C (gcc-4.6.1)" >C</option>
	<option value="1" label="C++" title="C++ (gcc-4.6.1)" >C++</option>
	<option value="10" label="Java"  title="Java (sun-jdk-1.6.0.30)" >Java</option>
</select>
<li><a id="example" href="?example_lang=11">範例</a></li>
<div id="tabs">
	<ul>
		<li><a href="#tabs-1">Code</a></li>
		<li><a class="doc" href="/cal-x/doc/1">Question Doc</a></li>
	</ul>
	<div id="tabs-1">
	<p>Select a theme: <select id="code_theme">
    <option selected>default</option>
    <option>night</option>
    <option>monokai</option>
    <option>neat</option>
    <option>elegant</option>
    <option>cobalt</option>
    <option>eclipse</option>
    <option>rubyblue</option>
	</select>
	</p>
	<textarea id="code"	name="code" rows="10" cols="100" placeholder="<Input your Code>" >{{ code }}</textarea>		
	<input type="submit" value="送出" />
	</div>
</div>

{% endblock %}
